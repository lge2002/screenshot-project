<!-- weather_report.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Analysis Report</title>
    <style>
        /* Basic styling for the body and headers */
        body { 
            font-family: 'Inter', sans-serif; /* Using Inter font as per instructions */
            margin: 20px; 
            background-color: #f4f4f4; 
            color: #333; 
        }
        h1, h2 { 
            color: #0056b3; 
            text-align: center; /* Center align headings */
        }

        /* Container for the filter section, with Tailwind-like styling */
        .filter-container { 
            margin-bottom: 30px; 
            padding: 20px; 
            background-color: #ffffff; /* White background */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* shadow-md */
            text-align: center; 
            max-width: 800px; /* Limit width */
            margin-left: auto; 
            margin-right: auto; /* Center the container */
        }

        /* Styling for select and input fields */
        .filter-container select, 
        .filter-container input[type="date"] { /* Removed input[type="time"] */
            padding: 0.625rem; /* p-2.5 */
            font-size: 1rem; /* text-base */
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* border-gray-300 */
            margin-bottom: 0.625rem; /* mb-2.5 */
            margin-right: 0.625rem; /* mr-2.5 */
            width: 100%; /* Full width on small screens */
            max-width: 200px; /* Max width on larger screens */
            box-sizing: border-box; /* Include padding and border in element's total width and height */
        }
        
        /* Responsive adjustments for filter inputs */
        @media (min-width: 640px) { /* sm:breakpoint */
            .filter-container input[type="date"] { /* Removed input[type="time"] */
                width: auto; /* Auto width on larger screens */
            }
        }

        /* Styling for the Apply Filter button */
        .filter-container button {
            padding: 0.625rem 1.25rem; /* px-5 py-2.5 */
            font-size: 1rem; /* text-base */
            background-color: #007bff; /* bg-blue-600 */
            color: white; /* text-white */
            border: none;
            border-radius: 0.375rem; /* rounded-md */
            cursor: pointer;
            transition: background-color 0.3s ease; /* transition duration-300 ease-in-out */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* shadow-sm */
        }
        .filter-container button:hover {
            background-color: #0056b3; /* hover:bg-blue-700 */
            box-shadow: 0 4px 6px rgba(0,0,0,0.15); /* hover:shadow-md */
        }

        /* Common container styling for image and data sections */
        .image-selection-container, .data-section { 
            margin-bottom: 30px; 
            padding: 20px; 
            background-color: #ffffff; 
            border-radius: 0.5rem; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            max-width: 1000px; /* Wider for images and data */
            margin-left: auto; 
            margin-right: auto; 
        }

        /* Image display area and item containers */
        .image-display-area { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 20px; 
            margin-top: 20px; 
        }
        .image-item-container { 
            display: none; /* Hidden by default, JavaScript will show */
            text-align: center; 
            border: 1px solid #e5e7eb; /* border-gray-200 */
            padding: 1rem; /* p-4 */
            border-radius: 0.5rem; /* rounded-lg */
            background-color: #f9fafb; /* bg-gray-50 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* shadow-sm */
            flex: 1 1 45%; /* Flex item to take about half width, adjust for gap */
            max-width: 45%; 
            box-sizing: border-box;
        }
        @media (max-width: 768px) { /* Adjust for smaller screens */
            .image-item-container {
                max-width: 90%; /* Stack on small screens */
                flex: 1 1 90%;
            }
        }
        .image-item-container img { 
            max-width: 100%; 
            height: auto; 
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #e5e7eb; /* border-gray-200 */
        }
        .image-item-container h3 { 
            margin-top: 0; 
            color: #1d4ed8; /* text-blue-700 */
        }
        .no-image-message { 
            color: #dc2626; /* text-red-600 */
            font-weight: bold; 
            margin-top: 0.625rem; /* mt-2.5 */
        }

        /* Styles for the data table */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            background-color: #fff; 
            border-radius: 0.5rem; 
            overflow: hidden; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        th, td { 
            border: 1px solid #e0e0e0; /* light gray border */
            padding: 10px; 
            text-align: left; 
        }
        th { 
            background-color: #e2f0ff; 
            color: #333; 
            font-weight: 600; /* semi-bold */
        }
        tr:nth-child(even) { 
            background-color: #f9f9f9; 
        }
        tr:hover { 
            background-color: #e0e0e0; 
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <h1>Weather Analysis Report</h1>

    <section class="filter-container">
        <h2>Filter Images by Date</h2>
        <form method="GET" action="">
            <label for="dateFilter" class="block mb-2 font-medium text-gray-700">Date:</label>
            <input 
                type="date" 
                id="dateFilter" 
                name="date" 
                value="{{ selected_date|default:'' }}" 
                class="block w-full sm:w-auto px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md focus:border-blue-500 focus:ring-blue-500 focus:outline-none"
            >
            
            <button type="submit" 
                    class="mt-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Apply Filter
            </button>
        </form>
    </section>

    <section class="image-selection-container">
        <h2>Select Image View</h2>
        <select id="imageSelector" 
                class="block w-full sm:w-auto px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:outline-none">
            <option value="">-- Select a View --</option>
            <option value="cropped_tn">Cropped Tamil Nadu (Radar Only)</option>
            <option value="masked_coimbatore">Shape-Masked Coimbatore (Isolated)</option>
            
            {% if image_urls.aligned_overlay_tn %}
                <option value="tn_overlay">Overall TN Map with District Outlines</option>
            {% else %}
                <option value="" disabled>Overall TN Map with District Outlines (Not Generated)</option>
            {% endif %}

            {% if image_urls.cropped_tn or image_urls.aligned_overlay_tn %}
                <option value="combined_full_tn">Combined Full TN View (Map + Outlines)</option>
            {% endif %}
        </select>

        <div class="image-display-area">
            {# Container for Cropped Tamil Nadu Image #}
            <div id="cropped_tn_container" class="image-item-container">
                <h3>Cropped Tamil Nadu (Radar Only)</h3>
                {% if image_urls.cropped_tn %}
                    <img src="{{ image_urls.cropped_tn }}" alt="Cropped Tamil Nadu Image" 
                         onerror="this.onerror=null;this.src='https://placehold.co/400x300/e0e0e0/000000?text=Image+Not+Available';"
                    >
                    <p>This image shows the full Tamil Nadu region as cropped, with radar data.</p>
                {% else %}
                    <p class="no-image-message">Cropped Tamil Nadu image not found for the selected date.</p>
                {% endif %}
            </div>

            {# Container for Shape-Masked Coimbatore Image #}
            <div id="masked_coimbatore_container" class="image-item-container">
                <h3>Shape-Masked Coimbatore</h3>
                {% if image_urls.masked_coimbatore %}
                    <img src="{{ image_urls.masked_coimbatore }}" alt="Shape-Masked Coimbatore Image"
                         onerror="this.onerror=null;this.src='https://placehold.co/400x300/e0e0e0/000000?text=Image+Not+Available';"
                    >
                    <p>This image shows the radar data masked to the shape of Coimbatore.</p>
                {% else %}
                    <p class="no-image-message">Shape-masked Coimbatore image not found for the selected date.</p>
                {% endif %}
            </div>

            {# Container for Overall TN Map with District Outlines #}
            <div id="tn_overlay_container" class="image-item-container">
                <h3>Overall TN Map with District Outlines</h3>
                {% if image_urls.aligned_overlay_tn %}
                    <img src="{{ image_urls.aligned_overlay_tn }}" alt="Tamil Nadu with Shape Overlay"
                         onerror="this.onerror=null;this.src='https://placehold.co/400x300/e0e0e0/000000?text=Image+Not+Available';"
                    >
                    <p>This map shows Tamil Nadu with geographic outlines, possibly with radar data and/or highlighted districts.</p>
                {% else %}
                    <p class="no-image-message">Overall TN map with district outlines not found for the selected date.</p>
                {% endif %}
            </div>
        </div>
    </section>

    {# You can re-add your Cloud Analysis data table here if needed #}
    <section class="data-section">
        <h2>Cloud Analysis Data</h2>
        {% if cloud_analysis_data %}
        <table>
            <thead>
                <tr>
                    <th>City</th>
                    <th>Values</th>
                    <th>Type</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
                {% for data in cloud_analysis_data %}
                <tr>
                    <td>{{ data.city }}</td>
                    <td>{{ data.values }}</td>
                    <td>{{ data.type }}</td>
                    <td>{{ data.timestamp|date:"Y-m-d H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="no-image-message">No Cloud Analysis data available for the selected date.</p>
        {% endif %}
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imageSelector = document.getElementById('imageSelector');
            const allImageContainers = document.querySelectorAll('.image-item-container');

            function showImageContainers(viewType) {
                // Hide all containers first
                allImageContainers.forEach(container => {
                    container.style.display = 'none';
                });

                // Show containers based on selection
                if (viewType === 'cropped_tn') {
                    document.getElementById('cropped_tn_container').style.display = 'block';
                } else if (viewType === 'masked_coimbatore') {
                    document.getElementById('masked_coimbatore_container').style.display = 'block';
                } else if (viewType === 'tn_overlay') {
                    document.getElementById('tn_overlay_container').style.display = 'block';
                } else if (viewType === 'combined_full_tn') {
                    // Show both cropped TN and the overlay map side-by-side
                    document.getElementById('cropped_tn_container').style.display = 'block';
                    document.getElementById('tn_overlay_container').style.display = 'block';
                }
            }

            // Add event listener for when the selection changes
            imageSelector.addEventListener('change', function() {
                showImageContainers(this.value);
            });

            // Set the default selection for the image selector on page load
            // This ensures if a filter was applied and images are available, a view is shown.
            const initialSelection = imageSelector.value;
            if (initialSelection) {
                showImageContainers(initialSelection);
            } else {
                // If no pre-selected option (e.g., first load without filters),
                // attempt to display the first available image type.
                if (document.getElementById('cropped_tn_container').querySelector('img') && 
                    document.getElementById('cropped_tn_container').querySelector('img').src !== 'https://placehold.co/400x300/e0e0e0/000000?text=Image+Not+Available') {
                    imageSelector.value = 'cropped_tn';
                    showImageContainers('cropped_tn');
                } else if (document.getElementById('masked_coimbatore_container').querySelector('img') &&
                           document.getElementById('masked_coimbatore_container').querySelector('img').src !== 'https://placehold.co/400x300/e0e0e0/000000?text=Image+Not+Available') {
                    imageSelector.value = 'masked_coimbatore';
                    showImageContainers('masked_coimbatore');
                } else if (document.getElementById('tn_overlay_container').querySelector('img') &&
                           document.getElementById('tn_overlay_container').querySelector('img').src !== 'https://placehold.co/400x300/e0e0e0/000000?text=Image+Not+Available') {
                    imageSelector.value = 'tn_overlay';
                    showImageContainers('tn_overlay');
                }
            }
        });
    </script>
</body>
</html>
